<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Opsporing: Decor & Trechteren</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --police-blue: #1d4e89; --gold: #ffd700; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #2d3748; }
        .container { max-width: 1200px; margin: auto; }
        
        .header { background: var(--police-blue); color: white; padding: 20px; text-align: center; border-bottom: 5px solid var(--gold); border-radius: 4px 4px 0 0; }
        
        /* Docent Console */
        .admin-panel { background: #fff; border: 2px dashed var(--police-blue); padding: 15px; margin-bottom: 20px; border-radius: 8px; text-align: center; }
        .admin-panel input { padding: 10px; width: 300px; border: 1px solid #ccc; border-radius: 4px; }
        
        /* Werkruimte Layout */
        .workspace { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        
        .map-container { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); height: 550px; }
        iframe { width: 100%; height: 450px; border: 0; border-radius: 4px; background: #eee; }

        .input-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        textarea { width: 100%; height: 250px; padding: 15px; border: 1px solid #cbd5e0; border-radius: 4px; font-family: inherit; box-sizing: border-box; resize: none; }
        
        .btn-send { background: #28a745; color: white; border: none; padding: 15px; width: 100%; font-weight: bold; cursor: pointer; text-transform: uppercase; margin-top: 10px; border-radius: 4px; }
        .btn-admin { background: var(--police-blue); color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; font-weight: bold; }

        /* Live Feed & Feedback */
        .aangifte-kaart { background: white; margin-top: 20px; padding: 20px; border-radius: 8px; display: grid; grid-template-columns: 1fr 380px; gap: 20px; border-left: 8px solid var(--police-blue); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .feedback-box { background: #fffdf2; padding: 15px; border: 1px solid var(--gold); border-radius: 5px; }
        
        .vinklijst { list-style: none; padding: 0; font-size: 0.85em; margin: 0 0 15px 0; }
        .vinklijst li { margin-bottom: 8px; display: flex; align-items: center; }
        .vinklijst input { margin-right: 10px; transform: scale(1.2); }
        
        .instruction-box { font-size: 0.85em; color: #4a5568; background: #edf2f7; padding: 12px; border-radius: 5px; margin-bottom: 15px; border-left: 4px solid var(--gold); }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Oefening: Decorbeschrijving & Trechteren</h1>
    </div>

    <div class="admin-panel">
        <strong>DOCENT:</strong> Stel locatie in voor de klas: 
        <input type="text" id="locatie-input" placeholder="bijv: Dam, Amsterdam of coördinaten">
        <button class="btn-admin" onclick="wijzigLocatie()">UPDATE DECOR</button>
        <button class="btn-admin" style="background:#e53e3e;" onclick="wisAlles()">RESET FEED</button>
    </div>

    <div class="workspace">
        <div class="map-container">
            <h3 id="huidige-locatie-titel">Decor: Laden...</h3>
            <iframe id="map-iframe" src=""></iframe>
        </div>

        <div class="input-container">
            <input type="text" id="student-naam" placeholder="Je voornaam" style="width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #cbd5e0; border-radius: 4px;">
            <div class="instruction-box">
                <strong>RICHTLIJNEN:</strong><br>
                • Beschrijf positie verbalisant.<br>
                • Trechteren: Van links naar rechts & groot naar klein.<br>
                • Elk element is het onderwerp van de zin.
            </div>
            <textarea id="input-tekst" placeholder="Begin hier met je beschrijving volgens de methodiek..."></textarea>
            <button class="btn-send" onclick="verstuurData()">Publiceer Decor-beschrijving</button>
        </div>
    </div>

    <h2 style="color: var(--police-blue); margin-top: 40px; border-bottom: 2px solid #cbd5e0; padding-bottom: 10px;">Live Feed: Klasresultaten</h2>
    <div id="live-feed">Wachten op inzendingen...</div>
</div>

<script>
    // --- FIREBASE CONFIGURATIE ---
    const firebaseConfig = {
        apiKey: "AIzaSyB12mTMBnuxdC4W4htyFO_C7Dnh3maVKew",
        authDomain: "decoroefening.firebaseapp.com",
        databaseURL: "https://decoroefening-default-rtdb.europe-west1.firebasedatabase.app/",
        projectId: "decoroefening",
        appId: "1:945998495824:web:a76dc7519b3b262a021155"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // --- MAP SYNC FUNCTIES ---
    function wijzigLocatie() {
        const nieuwAdres = document.getElementById('locatie-input').value;
        if(nieuwAdres) {
            database.ref('decor_instellingen').update({ huidige_locatie: nieuwAdres });
        }
    }

    database.ref('decor_instellingen/huidige_locatie').on('value', (snapshot) => {
        const locatie = snapshot.val() || "Utrecht Centraal";
        document.getElementById('huidige-locatie-titel').innerText = "Decor: " + locatie;
        const encodedLoc = encodeURIComponent(locatie);
        // We gebruiken de Google Maps Embed URL
        document.getElementById('map-iframe').src = `https://www.google.com/maps?q=${encodedLoc}&output=embed`;
    });

    // --- DATA FUNCTIES ---
    function verstuurData() {
        const naam = document.getElementById('student-naam').value;
        const tekst = document.getElementById('input-tekst').value;
        if(!naam || !tekst) return alert("Vul je naam en beschrijving in.");

        database.ref('decor_oefeningen').push({
            naam: naam,
            tekst: tekst,
            feedback: { c1:false, c2:false, c3:false, c4:false, c5:false, c6:false, opmerking: "" }
        });
        document.getElementById('input-tekst').value = '';
    }

    function updateCheck(key, field, value) {
        database.ref('decor_oefeningen/' + key + '/feedback').update({ [field]: value });
    }

    function liveFeedback(key, value) {
        database.ref('decor_oefeningen/' + key + '/feedback').update({ opmerking: value });
    }

    function wisAlles() {
        if(confirm("Feed leegmaken voor een nieuwe ronde?")) {
            database.ref('decor_oefeningen').remove();
        }
    }

    // --- LIVE FEED RENDEREN ---
    database.ref('decor_oefeningen').on('value', (snapshot) => {
        const feed = document.getElementById('live-feed');
        feed.innerHTML = '';
        const data = snapshot.val();
        if (data) {
            Object.keys(data).reverse().forEach(key => {
                const item = data[key];
                const fb = item.feedback || {};
                const kaart = document.createElement('div');
                kaart.className = 'aangifte-kaart';
                kaart.innerHTML = `
                    <div>
                        <strong style="color:var(--police-blue);">Verbalisant: ${item.naam}</strong>
                        <div style="white-space: pre-wrap; background: #f8fafc; padding: 15px; margin-top: 10px; border-radius: 4px; border: 1px solid #edf2f7; font-size: 0.95em;">${item.tekst}</div>
                    </div>
                    <div class="feedback-box">
                        <strong>CONTROLELIJST</strong>
                        <ul class="vinklijst">
                            <li><input type="checkbox" ${fb.c1?'checked':''} onchange="updateCheck('${key}','c1',this.checked)"> Kaal decor (TT)</li>
                            <li><input type="checkbox" ${fb.c2?'checked':''} onchange="updateCheck('${key}','c2',this.checked)"> Veranderlijk decor (VT)</li>
                            <li><input type="checkbox" ${fb.c3?'checked':''} onchange="updateCheck('${key}','c3',this.checked)"> Positie verbalisant</li>
                            <li><input type="checkbox" ${fb.c4?'checked':''} onchange="updateCheck('${key}','c4',this.checked)"> Van links naar rechts</li>
                            <li><input type="checkbox" ${fb.c5?'checked':''} onchange="updateCheck('${key}','c5',this.checked)"> Van groot naar klein</li>
                            <li><input type="checkbox" ${fb.c6?'checked':''} onchange="updateCheck('${key}','c6',this.checked)"> Element = Onderwerp</li>
                        </ul>
                        <strong>OPMERKINGEN (LIVE)</strong>
                        <textarea oninput="liveFeedback('${key}', this.value)" style="height:70px; font-size:0.85em; margin-top:5px;" placeholder="Typ hier feedback voor de klas...">${fb.opmerking || ""}</textarea>
                    </div>
                `;
                feed.appendChild(kaart);
            });
        } else {
            feed.innerHTML = 'Wachten op inzendingen...';
        }
    });
</script>
</body>
</html>
